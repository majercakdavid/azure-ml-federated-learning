$schema: https://azuremlschemas.azureedge.net/latest/commandComponent.schema.json
type: command

description: "Contact peer nodes through service bus then starts pinging head node."

name: crossgeo_ping
display_name: CrossGeo Ping
version: 0.1.0

code: ../

inputs:
  # data loading
  sb_rank:
    type: integer
  sb_size:
    type: integer
  sb_auth:
    type: string
  sb_host:
    type: string
    optional: true # if not specified, you need to use connection string
  sb_topic:
    type: string
  sb_sub:
    type: string
    optional: true # if not specified, will use run.parent.id from azureml-core

command: >-
  python ping/run.py
  --sb_auth ${{inputs.sb_auth}}
  $[[--sb_host ${{inputs.sb_host}}]]
  --sb_rank ${{inputs.sb_rank}}
  --sb_size ${{inputs.sb_size}}
  --sb_topic ${{inputs.sb_topic}}
  $[[--sb_sub ${{inputs.sb_sub}}]]

environment:
  conda_file: ./env.yaml
  image: mcr.microsoft.com/azureml/openmpi4.1.0-ubuntu20.04:latest
